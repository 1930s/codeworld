<html>
  <head>
    <script language="javascript" src="js/blocks_rts.js"></script>
    <script language="javascript" src="js/blocks_lib.js"></script>
    <script language="javascript" src="js/blocks_out.js"></script>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

    <link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
    integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/blockly.css">
    <link rel="stylesheet" href="css/funblocks.css">
    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/codeworld-cm.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.0/sweetalert.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script
    src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
    integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
    crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <script src="blockly/blockly_compressed.js"></script>
    <script src="blockly/blocks_compressed.js"></script>
    <script src="blockly/msg/js/en.js"></script>
    
    <!-- Initialization in JS -->
    <script src="js/codeworld_shared.js"></script> 
    <script src="js/blockworld.js"></script> 
    <!-- JS Blockly Code Generation Initialization -->
    <script src="js/codegen.js"></script>
  </head>


  <body>
    <div class="container-fluid">
      <nav class="navbar navbar-default">
        <a class="navbar-brand" href="/blocks">CodeWorld Blocks</a>
        <ul class="nav navbar-nav">
          <li><a href="/">Code</a></li>
        </ul>
      <button type="button" onclick="signOut()" id="signout" style="margin-right: 40px;" class="btn btn-default navbar-btn navbar-right">Sign out</button>
      <p class="navbar-text navbar-right" style="margin-right: 40px;"
      id="navbarsignin">Signed in as <a id="username" class="navbar-link">Johny</a></p>
      <button type="button" onclick="signin()" id="signin" style="margin-right: 40px;" class="btn btn-default navbar-btn navbar-right">Sign in</button>
      </nav>
    </div>
    
  <div class="container-fluid">
    <div class="row full">
        <div id="sidebar" class="col-md-2 collapsed">
            <h4>Projects</h4>
            <div class="btn-group-vertical" style="width:100%;" role="group">
              <button type="button" class="btn btn-default" id="newButton"
                onclick="newProject()">New</button>
              <button type="button" class="btn btn-default" style="display:
                none;" id="saveButton" onclick="saveProject()">Save</button>
              <button type="button" class="btn btn-default" style="display:
                none;" id="saveAsButton" onclick="saveProjectAs()">Save as</button>
            </div>
            </br></br>
            <div class="btn-group-vertical" style="width: 100%;" id="projects">
            </div>
            
        </div>

        <div id="main" class="col-md-8">
            <div class="row">
                <div class="col-md-12">

                  <xml id="toolbox" style="display: none">
                      <category name="Programs">
                          <block type="cwDrawingOf">
                            <value name="VALUE">
                              <shadow type="cwBlank"></shadow>
                            </value>
                          </block>
                          <block type="comment"></block>
                      </category>
                      <category name="Pictures">
                          <block type="cwBlank"></block>
                          <block type="cwCoordinatePlane"></block>
                          <block type="cwCodeWorldLogo"></block>
                          <block type="cwCircle">
                            <value name="RADIUS">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwSolidCircle">
                            <value name="RADIUS">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwThickCircle">
                            <value name="RADIUS">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                            <value name="LINEWIDTH">
                              <shadow type="numNumber">
                                <field name="NUMBER">1</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwRectangle">
                            <value name="WIDTH">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                            <value name="HEIGHT">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwThickRectangle">
                            <value name="WIDTH">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                            <value name="HEIGHT">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                            <value name="LINEWIDTH">
                              <shadow type="numNumber">
                                <field name="NUMBER">1</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwSolidRectangle">
                            <value name="WIDTH">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                            <value name="HEIGHT">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwText">
                            <value name="TEXT">
                              <shadow type="text_typed">
                                <field name="TEXT"></field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwArc">
                            <value name="STARTANGLE">
                              <shadow type="numNumber">
                                <field name="NUMBER">45</field>
                              </shadow>
                            </value>
                            <value name="ENDANGLE">
                              <shadow type="numNumber">
                                <field name="NUMBER">135</field>
                              </shadow>
                            </value>
                            <value name="RADIUS">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwSector">
                            <value name="STARTANGLE">
                              <shadow type="numNumber">
                                <field name="NUMBER">45</field>
                              </shadow>
                            </value>
                            <value name="ENDANGLE">
                              <shadow type="numNumber">
                                <field name="NUMBER">135</field>
                              </shadow>
                            </value>
                            <value name="RADIUS">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwThickArc">
                            <value name="STARTANGLE">
                              <shadow type="numNumber">
                                <field name="NUMBER">45</field>
                              </shadow>
                            </value>
                            <value name="ENDANGLE">
                              <shadow type="numNumber">
                                <field name="NUMBER">135</field>
                              </shadow>
                            </value>
                            <value name="RADIUS">
                              <shadow type="numNumber">
                                <field name="NUMBER">5</field>
                              </shadow>
                            </value>
                            <value name="LINEWIDTH">
                              <shadow type="numNumber">
                                <field name="NUMBER">1</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="lists_path"></block>
                      </category>
                      <category name="Transformations">
                          <block type="cwCombine">
                            <value name="PIC1">
                              <shadow type="cwBlank"></shadow>
                            </value>
                            <value name="PIC2">
                              <shadow type="cwBlank"></shadow>
                            </value>
                          </block>
                          <block type="cwColored">
                            <value name="PICTURE">
                              <shadow type="cwBlank"></shadow>
                            </value>
                            <value name="COLOR">
                              <shadow type="cwBlack"></shadow>
                            </value>
                          </block>
                          <block type="cwTranslate">
                            <value name="PICTURE">
                              <shadow type="cwBlank"></shadow>
                            </value>
                            <value name="X">
                              <shadow type="numNumber">
                                <field name="NUMBER">0</field>
                              </shadow>
                            </value>
                            <value name="Y">
                              <shadow type="numNumber">
                                <field name="NUMBER">0</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwRotate">
                            <value name="PICTURE">
                              <shadow type="cwBlank"></shadow>
                            </value>
                            <value name="ANGLE">
                              <shadow type="numNumber">
                                <field name="NUMBER">0</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwScale">
                            <value name="PICTURE">
                              <shadow type="cwBlank"></shadow>
                            </value>
                            <value name="HORZ">
                              <shadow type="numNumberPerc">
                                <field name="NUMBER">100</field>
                              </shadow>
                            </value>
                            <value name="VERTZ">
                              <shadow type="numNumberPerc">
                                <field name="NUMBER">100</field>
                              </shadow>
                            </value>
                          </block>
                      </category>
                      <category name="Numbers">
                          <block type="numNumber"></block>
                          <block type="numNumberPerc"></block>
                          <block type="numAdd">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numSub">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numMult">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numDiv">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numExp">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numMax">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numMin">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numOpposite">
                            <value name="NUM">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numAbs">
                            <value name="NUM">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numRound">
                            <value name="NUM">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numReciprocal">
                            <value name="NUM">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numQuot">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numRem">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numPi">
                          </block>
                          <block type="numSqrt">
                            <value name="NUM">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numGCD">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="numLCM">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                      </category>
                      <category name="Text">
                          <block type="text_typed"></block>
                          <block type="txtConcat">
                            <value name="LEFT">
                              <shadow type="text_typed"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="text_typed"></shadow>
                            </value>
                          </block>
                          <block type="txtPrinted">
                            <value name="TEXT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="txtLowercase">
                            <value name="TEXT">
                              <shadow type="text_typed"></shadow>
                            </value>
                          </block>
                          <block type="txtUppercase">
                            <value name="TEXT">
                              <shadow type="text_typed"></shadow>
                            </value>
                          </block>
                      </category>
                      <category name="Colors">
                          <block type="cwRed"></block>
                          <block type="cwBlue"></block>
                          <block type="cwGreen"></block>
                          <block type="cwBrown"></block>
                          <block type="cwOrange"></block>
                          <block type="cwBlack"></block>
                          <block type="cwWhite"></block>
                          <block type="cwCyan"></block>
                          <block type="cwMagenta"></block>
                          <block type="cwYellow"></block>
                          <block type="cwAquamarine"></block>
                          <block type="cwAzure"></block>
                          <block type="cwViolet"></block>
                          <block type="cwChartreuse"></block>
                          <block type="cwRose"></block>
                          <block type="cwPink"></block>
                          <block type="cwPurple"></block>
                          <block type="cwGray">
                            <value name="VALUE">
                              <shadow type="numNumberPerc">
                                <field name="NUMBER">50</field>
                              </shadow>
                            </value>
                          </block>
                          <block type="cwMixed">
                            <value name="COL1">
                              <shadow type="cwRed"></shadow>
                            </value>
                            <value name="COL2">
                              <shadow type="cwOrange"></shadow>
                            </value>
                          </block>
                          <block type="cwLight">
                            <value name="COL">
                              <shadow type="cwRed"></shadow>
                            </value>
                          </block>
                          <block type="cwDark">
                            <value name="COL">
                              <shadow type="cwRed"></shadow>
                            </value>
                          </block>
                          <block type="cwBright">
                            <value name="COL">
                              <shadow type="cwRed"></shadow>
                            </value>
                          </block>
                          <block type="cwDull">
                            <value name="COL">
                              <shadow type="cwRed"></shadow>
                            </value>
                          </block>
                          <block type="cwTranslucent">
                            <value name="COL">
                              <shadow type="cwRed"></shadow>
                            </value>
                          </block>
                          <block type="cwRGBA">
                            <value name="RED">
                              <shadow type="numNumberPerc">
                                <field name="NUMBER">50</field>
                              </shadow>
                            </value>
                            <value name="BLUE">
                              <shadow type="numNumberPerc">
                                <field name="NUMBER">50</field>
                              </shadow>
                            </value>
                            <value name="GREEN">
                              <shadow type="numNumberPerc">
                                <field name="NUMBER">50</field>
                              </shadow>
                            </value>
                            <value name="ALPHA">
                              <shadow type="numNumberPerc">
                                <field name="NUMBER">100</field>
                              </shadow>
                            </value>
                          </block>
                      </category>
                      <category name="Logic">
                          <block type="conIf">
                            <value name="IF">
                              <shadow type="conTrue"></shadow>
                            </value>
                          </block>
                          <block type="conEq"></block>
                          <block type="conNeq"></block>
                          <block type="conAnd">
                            <value name="LEFT">
                              <shadow type="conTrue"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="conTrue"></shadow>
                            </value>
                          </block>
                          <block type="conOr">
                            <value name="LEFT">
                              <shadow type="conFalse"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="conFalse"></shadow>
                            </value>
                          </block>
                          <block type="conNot">
                            <value name="VALUE">
                              <shadow type="conTrue"></shadow>
                            </value>
                          </block>
                          <block type="conTrue"></block>
                          <block type="conFalse"></block>
                          <block type="conGreater">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="conGeq">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="conLess">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="conLeq">
                            <value name="LEFT">
                              <shadow type="numNumber"></shadow>
                            </value>
                            <value name="RIGHT">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="conEven">
                            <value name="VALUE">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="conOdd">
                            <value name="VALUE">
                              <shadow type="numNumber"></shadow>
                            </value>
                          </block>
                          <block type="conStartWith">
                            <value name="TEXTMAIN">
                              <shadow type="text_typed"></shadow>
                            </value>
                            <value name="TEXTTEST">
                              <shadow type="text_typed"></shadow>
                            </value>
                          </block>
                          <block type="conEndWith">
                            <value name="TEXTMAIN">
                              <shadow type="text_typed"></shadow>
                            </value>
                            <value name="TEXTTEST">
                              <shadow type="text_typed"></shadow>
                            </value>
                          </block>
                      </category>
                      <category name="Tuples">
                        <block type="pair_create_typed"> </block>
                        <!-- <block type="pair_first_typed"> </block>
                        <block type="pair_second_typed"> </block> -->
                      </category>
                      <category name="Lists">
                        <block type="lists_create_with_typed"></block>
                        <block type="lists_numgen">
                        <value name="LEFT">
                              <shadow type="numNumber">
                                <field name="NUMBER">1</field>
                              </shadow>
                            </value>
                        <value name="RIGHT">
                              <shadow type="numNumber">
                                <field name="NUMBER">10</field>
                              </shadow>
                        </value>
                        </block>
                        <block type="lists_comprehension"></block>
                        <block type="variables_get_lists"></block>
                        <block type="lists_length"></block>
                      </category>
                      <category name="Definitions" custom="PROCEDURE">
                      <block type="procedures_getVar"></block>
                      </category>
                      
                   </xml>
                

                <div id="blocklyDiv" style="height: 85%; width:100%;"> </div>

                </br>
                </div>
            </div>
        </div>
        <div class="col-md-4">
          <div id="result">
            <iframe id="runner" class="dropbox" width="400px;" 
              height="400px;"></iframe>
            
          </div>
          <h4><span class="label label-info">Generated Code</span>
          <a type="button" id="editButton" target="_blank" class="btn btn-primary btn-sm">
            <span class="glyphicon glyphicon-edit"></span>
            <span>Edit</span>
          </a> 
          </h4>
          <pre id="genCode" class="cm-s-default CodeMirror" style="width:100%; height:auto; padding:10px;">
          </pre> 
          
        </div> 
    </div>
  </div>
  </br>
  </br>
  <div class="container-fluid">
    <nav class="navbar navbar-default navbar-fixed-bottom" style="padding-left:
    10px;">
      <button type="button" id="toggle-sidebar" class="btn btn-default
        navbar-btn">
        <span class="glyphicon glyphicon-align-justify"></span>
        <span>Browse</span>
      </button> 
      <button type="button" class="btn btn-danger navbar-btn" id="btnStop">Stop</button>
      <button type="button" class="btn btn-success navbar-btn" id="btnRun">Run</button>
      <p class="navbar-text navbar-right" style="padding-right:
        30px;">Status:
        <a id="message">None</a> 
      </p>
    </nav>

  </div>

  <script>
  // TODO - Move to haskell
  $.fn.redraw = function(){
    $(this).each(function(){
      var redraw = this.offsetHeight;
    });
  };
  $('#toggle-sidebar').on('click', function(event)
  {

    event.preventDefault();
    $("#sidebar").toggleClass("collapsed");
    $("#main").toggleClass("col-md-8 col-md-6");
    $("#toggle-sidebar").toggleClass("btn-primary btn-default");

    // Ugly hacks to force redraw
    // Blockly.fireUiEvent(window, 'resize');

    window.dispatchEvent(new Event('resize'));
    $(window).trigger('resize');
    $('.container-fluid').redraw();
    $('.container-fluid').css('display', 'none').height();
    $('.container-fluid').css('display', 'block');

    Blockly.resizeSvgContents(Blockly.getMainWorkspace());
    Blockly.getMainWorkspace().resize();

    window.dispatchEvent(new Event('resize'));
    $(window).trigger('resize');

  });
  </script>

  <script src="js/blocks_runmain.js"></script> 

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.0/sweetalert.min.js" async></script>
  <script type="text/javascript" src="js/codemirror-compressed.js"></script>
  <script type="text/javascript" src="js/codeworld-mode.js"></script>
  <script type="text/javascript" src="https://apis.google.com/js/platform.js?onload=handleGAPILoad" async defer></script>
  <script type="text/javascript">init();</script>
  </body>

</html>
